<!--  <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> DECOMMENTARE SE SI VUOLE UTILIZZARE LE EL JSP --> 

<!-- <%@page language="java" contentType="text/html" import="java.sql.*" pageEncoding="UTF-8"%> -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
      <!--  <meta http-equiv=refresh content="5; url=/dashboard.html" />  Reindirizzare ad una pagina dopo 5 secondi -->  
        
        <title>DASHBOARD MalwareXPlatform</title>
        
       <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">  --> 
        <link rel="stylesheet" href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/wtf-forms.css">
  	    
        <link href="css/materialize.min.css" type="text/css" rel="stylesheet">
      
        <style type="text/css">
        
        	
        
        	.header {
				  overflow: hidden;
				  /* background-color: #f1f1f1; */
				  /* padding: 10px 10px; */
				  /* background: linear-gradient(red, yellow);
				  background: -moz-linear-gradient(#DDDDDD, #ffffff ); 
				  background: -webkit-linear-gradient(#DDDDDD, #ffffff); */ 
				  width:100%; 
				  height:70px;
			  
				  /* background-image: -webkit-linear-gradient(top, rgba(178,34,34, 0.5),  rgba(75, 107, 175, 1)); 
				  background-image: -moz-linear-gradient(top, rgba(178,34,34, 0.5),  rgba(75, 107, 175, 1));
				  background-image: -ms-linear-gradient(top, rgba(178,34,34, 0.5),  rgba(75, 107, 175, 1));
				  background-image: -o-linear-gradient(top, rgba(178,34,34, 0.5),  rgba(75, 107, 175, 1));
				  background-image: linear-gradient(to top, rgba(178,34,34, 0.5),  rgba(75, 107, 175, 1)); 	
			   */
			 	  /* background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 1)); */
			  /*  background-image: linear-gradient(to top, rgba(255, 255, 255, 0.6), rgba(187, 187, 187, 1)); */
			  
			      background-image: linear-gradient(to bottom, rgb(244, 244, 244, 0.6), rgb(244, 244, 244, 1)); 
			   
			  
			 /*  background: linear-gradient(top , #FFFFFF 0%, #AACFEF 100%); */
			 /*	 background: rgba(76, 175, 80, 0.6);  */
			   
			  /* background: rgba(0,0,0,0.5); */
			    
				
			}
					
			
			/* Style the header links */
			.header a {
			  float: left;
			  color: black;
			  text-align: center;
			  padding: 12px;
			  text-decoration: none;
			  font-size: 18px;
			  line-height: 25px;
			  border-radius: 4px;
			  opacity: 0.8;
			}
			
			/* Style the logo link (notice that we set the same value of line-height and font-size to prevent the header to increase when the font gets bigger */
			.header a.logo {
			  font-size: 25px;
			  font-weight: bold;
			  background: url('logoF.png');
			  /* background: url('definitivo1.png'); */
			  width: 200px; 
			  height: 70px;
			}
			
			/* Cambio il colore di sfondo quando passo il mouse sul logo e sul men√π dell'header */
			.header a:hover {
			  background-color: rgba(221, 221, 221, 0.3);/*  #ddd; */
			  color: black;
			}
			
			/* Stile del tasto Home*/
			.header a.active {
			  /*#1b9ebbf5
			  #26a69a*/
			  background-color: rgba(27, 158, 187, 0.9);
			  color: white;
			  
			}
			
			.header a.active:hover {
			  background-color: rgba(27, 158, 187, 1);
			  color: white;
			}
			
			
			/* Float the link section to the right */
			.header-right {
			  float: right;
			  padding: 10px 10px;
			}
			
			/* Add media queries for responsiveness - when the screen is 500px wide or less, stack the links on top of each other */
			@media screen and (max-width: 500px) {
			  .header a {
			    float: none;
			    display: block;
			    text-align: left;
			  }
			  .header-right {
			    float: none;
			  }
			}
        
        
            body{
                background: url(sfondomatrix.jpg);
                background-size: cover;
                width: 100%;
  				height:100%;
            }
            
            .drop-down-list{
                margin: 40px auto 10px;
                width: 90%;
                padding: 20px; /*in origine era 30px*/
                border-radius: 10px 10px 10px 10px; /*arrotonda i bordi*/
            } 
            
            /* Create four equal columns that floats next to each other */
			.column {
			 float: left;
			 width: 50%;
			}
			
			div.clearer{
    		 float: none; clear: left
    		}	 
			
			/* Clear floats */
			.row:after {
			 content: "";
			 display: table;
			 clear: both;
			}
           
            /* Responsive layout - makes a two column-layout instead of four columns */
			@media screen and (max-width: 900px) {
			 .column {
			 width: 50%;
			 }
			}
			
			
			/* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
			@media screen and (max-width: 600px) {
			 .column {
			 width: 100%;
			 }
			}
			
					
			input::file-selector-button {
			    font-weight: normal;
			    color: black;
			    padding: 0.5em;
			    border: thin solid grey;
			    border-radius: 3px;
			    cursor: pointer;
			    background-color: rgb(228, 239, 236);
			} 
			
			input[type="file"]::file-selector-button:hover {
			  background-color: transparent;
			  border: 1px solid #00cec9;
			} 
			
				            
            h5 {
        		font-size: auto;
			    font-weight: auto;
			    /*font-family: 'Niconne', cursive;*/
			    font-family: sans-serif, cursive;
			    color: rgb(0, 128, 128);
			 /*    text-shadow: 2px 2px 0px  #957dad,
               4px 4px 0px #ee4b2b,
               6px 6px 0px #00c2cb,
                8px 8px 0px #ff7f50,
               10px 10px 0px #553c9a; */
              
        	}
            
            /* === BASE HEADING === */ 

			h1 {
			  position: relative;
			  padding: 0;
			  margin: 0;
			  font-family: "Raleway", sans-serif;
			  font-size: auto;
			  font-weight: auto;
			  /* font-weight: 300;
			  font-size: 40px; */
			  /* color: #080808; */
			  color: rgb(72, 72, 72);
			  -webkit-transition: all 0.4s ease 0s;
			  -o-transition: all 0.4s ease 0s;
			  transition: all 0.4s ease 0s;
			}
			
			h1 span {
			  display: block;
			  font-size: 0.5em;
			  line-height: 1.3;
			}
			h1 em {
			  font-style: normal;
			  font-weight: 600;
			}
            
			            
			/* === HEADING STYLE #3 === */
			.exploit h1 {
			  font-size: 25px;
			  font-weight: 500;
			  letter-spacing: 0;
			  line-height: 1.5em;
			  padding-bottom: 15px;
			  /* padding-left: 10px;
			  padding-right: 20px; */
			  position: relative;
			  text-align:center; 
			  margin:auto;
			}
			.exploit h1:before {
			  /* margin-left: 10px; */
			  margin-right: 20px;			  
			  content: "";
			  position: absolute;
			  left: 0;
			  bottom: 0;
			  height: 5px;
			  width: 55px;
			  /* background-color: rgb(72, 72, 72); */
			  background-color: #b80000;
			}
			.exploit h1:after {
			  content: "";
			  position: absolute;
			  left: 0;
			  bottom: 2px;
			  height: 1px;
			  width: 100%;
			 /*  max-width: 255px; */
			  /* background-color: rgb(72, 72, 72); */
			  background-color: #b80000;
			}
			
			.signature h1 {
			  font-size: 25px;
			  font-weight: 500;
			  letter-spacing: 0;
			  line-height: 1.5em;
			  padding-bottom: 15px;
			  /* padding-left: 20px;
			  padding-right: 10px;  */
			  position: relative;
			  text-align:center; 
			  
			  
			  
			}
			
			/* BLOCCO GRANDE */
			.signature h1:before {			  			  
			  content: "";
			  position: absolute;
			  right: 0;
			  bottom: 0;
			  height: 5px;
			  width: 55px;
			  /* background-color: rgb(72, 72, 72); */
			  background-color: #b80000;
			}

			.signature h1:after {			  
			  content: "";
			  position: absolute;
			  left: 0;
			  bottom: 2px;
			  height: 1px;
			  width: 100%;
			  /* max-width: 100%; */
			  /* background-color: rgb(72, 72, 72); */
			  background-color: #b80000;
			}
			
			
			/* === HEADING STYLE #1 === */
			.one h1 {
			  text-align: center;
			  font-size: 25px;
			  font-weight: 500;
			  /* text-transform: uppercase; */
			  padding-bottom: 5px;
			}
			
			.one h1:before {
			  width: 28px;
			  height: 5px;
			  display: block;
			  content: "";
			  position: absolute;
			  bottom: 3px;
			  left: 50%;
			  margin-left: -14px;
			  background-color: #b80000;
			}
			
			
			.one h1:after {
			  width: 100px;
			  height: 1px;
			  display: block;
			  content: "";
			  position: relative;
			  margin-top: 15px;
			  left: 50%;
			  margin-left: -50px;
			  background-color: #b80000;
			}
			
			
			/* SETTING PER L'UPLOAD DEI FILE EXPLOIT E SIGNATURE (SELECT YOUR FILE)*/
			.file-upload-wrapper {
			  position: relative;
			  width: 100%;
			  height: 33px;
			}
			.file-upload-wrapper:after {
			  border-bottom: 1px solid #ccc;
			  border-right: 1px solid #ccc;
			  border-top: 1px solid #ccc; 
			  content: attr(data-text);
			  font-size: 15px;
			  position: absolute;
			  top: 0;
			  right: 0;
			  background: #fff;
			  padding: 5px 5px 5px 30px;
			  /* padding: 10px 15px; */
			  display: block;
			  width: calc(100% - 10%);
			  pointer-events: none;
			  z-index: 0;
			  height: 33px;
			  /* line-height: 20px; */
			  text-align:center;
			  color: #999;
			  border-radius: 0px 5px 5px 0px;
			  font-weight: 300;
			}
			.file-upload-wrapper:before {
			  border: thin solid grey;
			  content: "Select...";
			  position: absolute;
			  top: 0;
			  left: 0;
			  display: block;
			  height: 33px;
			  background: rgb(228, 239, 236);
			  /* background: rgb(124, 124, 124, 0.8); */
			  color: black;
			  font-weight: 500;
			  z-index: 25;
			  font-size: 16px;
			  line-height: 20px;
			  padding: 5px 5px 5px 5px;
			  text-align: center;
			  /* padding: 0 15px; */
			  /* text-transform: uppercase; */
			  pointer-events: none;
			  border-radius: 5px 0px 0px 5px;
			}
			
			.file-upload-wrapper:hover:before {
			  background-color: rgb(224, 243, 243) ;
			  border: 1px solid #00cec9;
			}
			
			/*indica l'area di attivazione dell'apertura della finestra di caricamento del file'*/
			.file-upload-wrapper input {
			  opacity: 0;
			  position: absolute;
			  top: 0;
			  right: 0;
			  bottom: 0;
			  left: 0;
			  z-index: 99;
			  height: 33px;
			  margin: 0;
			  padding: 0;
			  display: block;
			  cursor: pointer;
			  width: 100%;
			}
			
			#progressContainer {
			  margin-top: 5px;			  
			  width: 100%;
			  height: 6px;
			  background-color: rgb(228, 239, 236);
			/*border: thin solid #ccc; */
			  border-radius: 10px; /* Modifica il valore per ottenere la forma desiderata */
			  overflow: hidden;
			}
			
			#progressBar {
			  vertical-align: top; /*importante per allineare la progressbar nel progressContainer*/
			  width: 100%;
			  height: 100%;
			  background-color: rgb(224, 243, 243);
			  border: 1px solid #ccc;
			  border-radius: 10px; /* Modifica il valore per ottenere la forma desiderata */
			  transition: width 0.3s ease-in-out;
			  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* Aggiunge un'ombra alla barra di avanzamento */
			}
			
			#progressContainer2 {
			  margin-top: 5px;			  
			  width: 100%;
			  height: 6px;
			  background-color: rgb(228, 239, 236);
			/*border: thin solid #ccc; */
			  border-radius: 10px; /* Modifica il valore per ottenere la forma desiderata */
			  overflow: hidden;
			}
			
			#progressBar2 {
			  vertical-align: top;
			  width: 100%;
			  height: 100%;
			  background-color: rgb(224, 243, 243);
			  border: 1px solid #ccc;
			  border-radius: 10px; /* Modifica il valore per ottenere la forma desiderata */
			  transition: width 0.3s ease-in-out;
			  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* Aggiunge un'ombra alla barra di avanzamento */
			}
            
        </style>
        
    </head>
    
    <body class="">
        
            
            <div class="header">
			  <a href="dashboard.html" class="logo"></a>
			  <div class="header-right">
			    <a class="active" href="dashboard.html">Home</a>
			    <a href="admin.html">Admin Login</a>
			    <a href="#about">About</a>
			  </div>
			</div> 
			
           <div class="container">
           	  
   
   			  <!-- FORM PER LA CREAZIONE DEL PE file -->
                
	            <div class="drop-down-list card" style="float:center; ">  
	            	
	            	<!-- DEVO FARE LA DIVISIONE IN COLONNE -->
	            	
	            	<div class="column">
	            	
	            	 	<div class="input-field" style="padding: 10px 20px 10px 10px;">
	            	 	<div class="exploit">
						  <h1>Select Exploit</h1>
						</div>
	            		</div>
	            	
		            	<!-- <div class="center" style="float:center;" >
		                    <h5>SELECT EXPLOIT</h5>
		                </div> 
		                <div class="divider"></div>  -->
		                <!-- INSERIRE I NOMI DEGLI EXPLOIT -->
		             
	                
	                </div>
	                
	                
	                <div class="column">
	            	
	            		
	            		<div class="input-field" style="padding: 10px 10px 10px 20px;">
	            		<div class="signature">
						  <h1>Select Signature</h1>
						</div>
	            		</div>
	            	
		            	<!-- <div class="center" style="float:center;" >
		                    <h5>SELECT SIGNATURE</h5>
		                </div>
		                <div class="divider"></div> -->
		                
		                <!-- INSERIRE LE SIGNATURE -->
		              	                
	                </div>
	                
	            	<div class="clearer"> </div>
	            	
	         	     
	         	    <form> 
	            		
	            		<div class="column">
	            			
	            			            		
	            		
							<div class="input-field" style="padding: 0px 20px 10px 10px; margin-top: 0px">
		                        
		                        <select id="exploit" name="idExploit">
		                            <option>Select Exploit</option>
		                        </select>
		                        		                        	                        
		                    </div>  
		                    
	                    </div>  
	                    
	                    <div class="column">
	                    
	                    		                    
	                    	<div class="input-field" style="padding: 0px 10px 10px 20px; margin-top: 0px">
		                        
		                        <select id="signature" name="idSignature">
		                            <option>Select Signature</option>
		                        </select>
		                                             
		                        	                        
		                    </div> 
	                    
	                    </div>  
	                    
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Inject in .EXE " id="buttonCreate">          		
	                    <!-- <button class="btn" id="buttonCreate" >Create</button> CON <BUTTON> NON FUNZIONA IL redirect NELLE FUNZIONI JQUERY window.location.href = "dashboard.html" --> 
	                    </div>
	                    
	            	</form>
	          			 
	          			 	            
	            </div>
	                
	    	<!-- <div class="divider"></div> -->
	    
<!--  INSERIRE 2 MENU' PER L'UPLOAD DI EXPLOID E SIGNATURE, LE SIGNATURE POSSONO ESSERE CARICATE IN FORMATO .TXT -->
			  
			  
			<!-- PRIMA COLONNA PER L'UPLOAD DELL'EXPLOIT-->     
		 	<div class="column">
                        
            <!-- FORM PER L'UPLOAD DELL'EXPLOIT-->
                
	            <div class="drop-down-list card" style="float:left; ">  
	            	
	            	<div class="input-field">
	            		
	            		<div class="one">
					  		<h1>Upload Exploit</h1>
						</div>
						
	            	</div>
	            	
	            	
	            	<!-- <div class="center">
	                    <h5>UPLOAD EXPLOIT</h5>
	                </div>
	            	<div class="divider"></div> -->
	            	
	            	
	            	<form id="uploadformExploit" method="POST" action="#" enctype="multipart/form-data"> 
	            	
	            		<div class="input-field">
	            			<input id="nameExploit" type="text" size="50" maxlength="300" title="Insert Exploit Name" placeholder="Insert Exploit Name" value="" name="exploitname" >
	            		</div>
	            	                		
						<div class="input-field">
	                        
	                        
	                        <div class="file-upload-wrapper" data-text="Select your file!">
      							<input id="exploitFile" name="fileExploit" type="file" class="file-upload-field">
	                        </div>
	                        
	                        <div id="progressContainer" style="display: none;">
						    	<progress id="progressBar" value="0" max="100" ></progress>
						  	</div>
	                        
	                        <!-- <input id="exploitFile" type="file" name="fileExploit"> -->
	                                                
	                        
	                        <!-- <label for="exploitFile">Choose a file</label><br> -->
							<!-- name of file chosen -->
							<!-- <span id="file-chosen">No file chosen</span>	  -->
						    <!-- accept="image/png, image/jpeg"  -->
							                        	                        
	                    </div>
	                    
	                    <!-- <progress></progress>  -->   
	                    
						<!-- <label class="file">
						  <input type="file" id="file" aria-label="File browser example">
						  <span class="file-custom"></span>
						</label> -->
      
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Upload" id="buttonUploadExploit">          
	                    </div>
	            	</form>
	          			 
	          			 	            
	            </div>
	           
	       
         </div>
		 	
		 
		 <!-- SECONDA COLONNA PER L'UPLOAD DELLA SIGNATURE -->
		 	
		 <div class="column">
		 
		 	 <!-- FORM PER L'UPLOAD DELLA SIGNATURE-->
                
	            <div class="drop-down-list card" style="float:right; ">  
	            	
	            	
	            	<div class="input-field">
	            		
	            		<div class="one">
					  		<h1>Upload Signature</h1>
						</div>
						
	            	</div>
	            	         	
	            	
	            	<!-- <div class="center">
	                    <div class="one">
					  		<h1>Upload Signature</h1>
						</div>
					<h5>UPLOAD SIGNATURE</h5>
	                </div>
	            	<div class="divider"></div> -->
	            	
	            	
	            	<form id="uploadformSignature" method="POST" action="#" enctype="multipart/form-data"> 
	            		
	            		<div class="input-field">
	            			<input id="nameSignature" type="text" size="50" maxlength="300" title="Insert Signature Name" placeholder="Insert Signature Name" value="" name="signaturename" >
	            		</div>      		      		           		
	            		
	            		
						<div class="input-field">
	                        
	                        <!-- <input id="signatureFile" type="file" name="fileSignature"> -->
	                        
	                        <div class="file-upload-wrapper" data-text="Select your file!">
      							<input id="signatureFile" type="file" name="fileSignature" class="file-upload-field">
	                        </div>
	                        
	                        <div id="progressContainer2" style="display: none;">
						    	<progress id="progressBar2" value="0" max="100"></progress>
						  	</div>
	                        
	                        	                        	                        
	                    </div>  
	                    
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Upload" id="buttonUploadSignature">          
	                    </div>
	            	</form>
	          			 
	          			 	            
	            </div>
	           
		
	     </div>
		
		
		<div class="divider"></div>     
	     
	     
	    </div> 
 
               
      
	  	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> <!-- Utilizzata per i drop down men√π -->
  	    
  	   
  	    <!-- Utilizzata per la finestra popout (Sweet Alert) con gli avvisi in seguito all'associazione o alla creazione dei nodi sensori -->
  	    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
  	   <!--  <script src="sweetalert2.all.min.js"></script> -->
  	    
  	   
        <script type="text/javascript">           
            
        
	        $("form").on("change", ".file-upload-field", function(){ 
	            $(this).parent(".file-upload-wrapper").attr("data-text", $(this).val().replace(/.*(\/|\\)/, '') );
	        });
        
        
        	$(document).ready(function () {        		
                
        		//MENU' SELEZIONE EXPLOIT
        		$.ajax({
                	url: "ServletAjaxExploitList",
                    method: "GET",
                    data: {operation: 'exploitList'},
                    success: function (data, textStatus, jqXHR) {
  
                    	console.log("Exploit List: " + data);
                        let exploitList = $.parseJSON(data);
                        console.log("exploitList: " + exploitList);
                     
                        $.each(exploitList, function (key, value) {	
                    	  	console.log("value id: " + value.idExploit );
                        	console.log("value name: " + value.exploit);
                            $('#exploit').append('<option value="' + value.idExploit + '">' + value.exploit + '</option>')
                        });
                        $('select').formSelect();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#exploit').append('<option>Exploit Unavailable</option>');
                    },
                    cache: false
                });
        		
        		
        		//MENU' SELEZIONE SIGNATURE
        		$.ajax({
                	url: "ServletAjaxSignatureList",
                    method: "GET",
                    data: {operation: 'signatureList'},
                    success: function (data, textStatus, jqXHR) {
  
                    	console.log("Signature List: " + data);
                        let signatureList = $.parseJSON(data);
                        console.log("signatureList: " + signatureList);
                     
                        $.each(signatureList, function (key, value) {	
                    	  	console.log("value id: " + value.idSignature );
                        	console.log("value name: " + value.signature);
                            $('#signature').append('<option value="' + value.idSignature + '">' + value.signature + '</option>')
                        });
                        $('select').formSelect();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#signature').append('<option>Signature Unavailable</option>');
                    },
                    cache: false
                });
        		     		
        		
        	 	//FUNZIONE PER AVVIARE IL DOWNLOAD DEL FILE EXE CREATO
        		async function download(url, filename) {
        		    
        	 		console.log("ENTRO IN DOWNLOAD");
        	 		console.log(url);
        	 		
        	    	const data = await fetch(url)
        	    	console.log("data: " + data)
        	    	
        			const blob = await data.blob()
        			const objectUrl = URL.createObjectURL(blob)

        			const link = document.createElement('a')

        			link.setAttribute('href', objectUrl)
        			link.setAttribute('download', filename)
        			link.style.display = 'none'

        			document.body.appendChild(link)
        			  
        			link.click()
        			console.log("CLICK DOWNLOAD" )
        			  
        			document.body.removeChild(link)
      
      				console.log("FINE FUNZIONE DOWNLOAD" )
        		}; 
        		
        		//FUNZIONE CLIC BOTTOM CREATE FILE EXE
                $('#buttonCreate').click(function () {	 
      			    console.log("CLIC BUTTOM");
      			    
      			    //PRENDE L'EXPLOIT SCELTO
      				let idExploit = $('#exploit').val(); //sarebbe l'id nel form
      				console.log("EXPLOIT: " + exploit);
      				
      				//PRENDE LA SIGNATURE SCELTA      				
      				let idSignature = $('#signature').val(); //sarebbe l'id nel form
      				console.log("SIGNATURE ID: " + signature);
      			    
      				if(idExploit == "Select Exploit"){    		
      		    		//INSERIRE IL POPOUT DI ERRORE
      		    		console.log("devi selezionare un exploit dalla lista");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Devi scegliere un exploit dalla lista!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      		  			    //confirmButtonText: 'Ho capito!'
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })			    
      		    	}
      				else if(idSignature == "Select Signature"){
      				//INSERIRE IL POPOUT DI ERRORE
      		    		console.log("devi selezionare una signature dalla lista");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Devi scegliere una signature dalla lista!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      		  			    //confirmButtonText: 'Ho capito!'
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })
      				}
      				else{	
      							
	      				//PREPARO IL PACCHETTO DA INVIARE ALLA SERVLET
	      			    let dati = {
	      			    	exploit : idExploit, //EXPLOIT
	      			    	signature : idSignature //SIGNATURE
	      			    };
	      			  //console.log("DEVICE: " + dati.device);
	      				
	      			    //CHIAMA LA SERVLET DI CREAZIONE DELL'EXE
	      			    $.ajax({      					 
	      					 url: "ServletCreateExe",
	      					 dataType: "json",
	      					 method: "POST",
	      			         data: dati,    //$("#idForm").serialize()                    
	      			         async: false,
	      			         
	      			         //LA SERVLET DEVE INVIARE L'URL DEL FILE DA SCARICARE
	      			         success: function (messaggio, textStatus, jqXHR) { //messaggio Ë il messaggio ricevuto dalla servlet
	      			        	console.log("SUCCESSS");
	      			        	
	      			               			        	
	      			            let url = messaggio.url;      			   
	    			      		console.log("url: " + messaggio.url);
	      			         
	      			        	//INSERIRE IL MESSAGGIO CON ANIMAZIONE
	      			          	let m = messaggio.messaggio;      			   
	    			      		console.log("messaggio: " + messaggio.messaggio);
	    			      		console.log("nomefile da scaricare: " + messaggio.nomefile);
	    			      		if(messaggio.result == true){ //associazione Nodo Sensore Sensore √® andata a buon fine
		      			       		console.log("result true: " + messaggio.result);
				      			  	
		      			       	//AGGIUNGERE LA FUNZIONE PER SCARICARE IL FILE CREATO
		            			         
		         			        console.log("chiamo la funzione download")
		         			        console.log("url: " + messaggio.url)
			      			        //USARE L'URL PASSATO DALLA SERVLET
			      			        // Start file download.
			      			        download(messaggio.url, messaggio.nomefile)
				      			    // download(filename, text);
	    			      		  			      		
	    			      		    console.log("DOPO DOWNLOAD")
	    			      		    
	    			      		    let timerInterval
				      			    Swal.fire({
				      			    	icon: 'success',
				      			    //  title: m,
				      			    	text: m,
				      			    //  html: 'I will close in <b>4000</b> milliseconds.',
				      			      	timer: 4000,
				      				    showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      	 		    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    }) 
	    			     		}
	    			       		else{       			       			
		      			       		console.log("result false: " + messaggio.result);
		      			       		console.log("messaggio in else: " + messaggio.messaggio);
	    			       			
		      			       		
		      			       		let timerInterval
				      			    Swal.fire({
				      			    	icon: 'error',
				      			   // 	title: m,
				      			    	text: m,
				      			   //     html: 'I will close in <b>3</b> milliseconds.',
				      			      	timer: 4000,
				      				  //showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      		 	    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })       			       		
	    			       		}
	      			         },
	      			         error: function (jqXHR, textStatus, errorThrown) {
	      			        	 console.log("ERROREEEE");
	      			        	 alert('<form>State Unavailable</form>');
	      			         },
	      			         cache: false
	      			     });
      				}
      			   
      			}); 
        		
        		/*FUNZIONE PER EFFETTUARE VERIFICHE SUL FILE DA CARICARE*/
                $('#exploitFile').on('change', function () {
                	  //Questa variabile contiene il file vero e proprio
                	  var file = this.files[0];
                	                 	  
                	  var filename = $('#exploitFile').val();
        			  console.log("filename: " + filename);
        				
                	  //Controlli sul file come dicevo prima
                	  //Ad esempio qui, controlliamo che il file non sia pi√π grande di 1k
                	  if (file.size > 524288000) {
                		  let timerInterval
		      			    Swal.fire({
		      			    	icon: 'error',
		      			    	text: 'Il dimensione massima consentita per il file √® 50MB',
		      			      	timer: 4000,
		      				    showConfirmButton: true, //non mostrare il tasto ok
		      			      	timerProgressBar: true,
		      			   /* 	didOpen: () => {
		      			        	Swal.showLoading()
		      			        	const b = Swal.getHtmlContainer().querySelector('b')
		      			        	timerInterval = setInterval(() => {
		      			          		b.textContent = Swal.getTimerLeft()
		      			        	}, 100)
		      			      	}, 
		      			      	willClose: () => {
		      			        	clearInterval(timerInterval)
		      			      	} */
		      			    }).then((result) => {
		       			    	if (result.dismiss === Swal.DismissReason.timer) {
		      			        	console.log('I was closed by the timer')
		      			      		window.location.href = "dashboard.html";
		      			      	}
		      			      	else{
		      			    		window.location.href = "dashboard.html";
		      			      	}
		      			    })
                	  }
                	  
                	 
                	  //Verifico l'estensione del file
                	  //Use a regular expression to trim everything before final dot
                      var extension = filename.replace(/^.*\./, '');
                	  console.log("extension: " + extension)
                	  // Iff there is no dot anywhere in filename, we would have extension == filename,
			          // so we account for this possibility now
			          if (extension == filename) {
			             extension = '';
			          } else {
			            // if there is an extension, we convert to lower case
			            // (N.B. this conversion will not effect the value of the extension
			            // on the file upload.)
			             extension = extension.toLowerCase();
			          }
					  
                	  //indicare le estensioni ammesse per il file
                	  var fileExtension = ['exe', 'py'];
                	  if ($.inArray(extension, fileExtension) == -1) {
                		  let timerInterval
		      			    Swal.fire({
		      			    	icon: 'error',
		      			    	text: 'Estensione file non valida! Sono ammessi solo file di tipo ' + fileExtension.join(', '),
		      			      	timer: 4000,
		      				    showConfirmButton: true, //non mostrare il tasto ok
		      			      	timerProgressBar: true,
		       			    }).then((result) => {
		       			    	if (result.dismiss === Swal.DismissReason.timer) {
		      			        	console.log('I was closed by the timer')
		      			      		window.location.href = "dashboard.html";
		      			      	}
		      			      	else{
		      			    		window.location.href = "dashboard.html";
		      			      	}
		      			    })
                       }			                	  
                	  
                	  
                	});	
        		
        		
                /* FUNZIONE PER MOSTRARE BARRA DI CARICAMENTO */
                                
                function showProgressBar() {
                    $('#progressContainer').show();
				}
                
                function showProgressBar2() {
                    $('#progressContainer2').show();
				}
        		
                 /* showProgressBar();
                 showProgressBar2(); */
        		
                 /* FUNZIONE PER CARICARE L'EXPLOIT */	
        		$('#buttonUploadExploit').click(function (e) {	 
      			    console.log("CLIC BUTTOM");
      			   
      			    //e.preventDefault(); // Impedisce l'invio del form
      			    
      			    //prelevo tutti i dati inseriti nel form
      			    var form = $("#uploadformExploit")[0];
                    var dati = new FormData(form);
                    
      				let nameExploit = $('#nameExploit').val();
      				console.log("Name Exploit Upload: " + nameExploit);
      				let exploitFile = $('#exploitFile').val();
      				console.log("Exploit File: " + exploitFile);
      			    
      				if(nameExploit == ""){
      					//NESSUN NOME INSERITO
      		    		console.log("devi inserire un nome valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Inserire un nome valido per l\'Exploit!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })			
      					
      				}
      				else if(exploitFile == ""){
      					console.log("inserire file")
      					console.log("devi inserire un file valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Nessun file inserito per l\'upload!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })
      						
      				}
      				else{
      					showProgressBar(); // Mostra la barra di avanzamento
	      				
      					var progressBar = $('#progressBar');
      					 
	      				 $.ajax({      					 
	      					 url: "ServletUploadExploit",
	      			         method: "POST",
	          				 encType: 'multipart/form-data',
	      			   	     cache: false,
	    					 contentType: false,
	    					 processData: false,
	      			   	     data: dati,    //$("#idForm").serialize()                    
	      			         xhr: function() {
						     var xhr = new window.XMLHttpRequest();
						
						     // Aggiungi un listener per l'evento di progresso
						     xhr.upload.addEventListener('progress', function(e) {
						       if (e.lengthComputable) {
						         var percent = Math.round((e.loaded / e.total) * 100);
						         progressBar.val(percent);
						       }
						     }, false);
	      			   	     
						     return xhr;
	      			       },
	      			   	     
	      			   	     
	      			   	     
	      			   	     // Esecuzione della XMLHTTP REquest
						/*	    xhr: function () {
							      var myXhr = $.ajaxSettings.xhr();
							      if (myXhr.upload) {
							        
							        //Qui, agiamo a tutti gli effetti sul tag "PROGRESS" in modo tale da aggiornare l'utente finale sul progresso di upload
							        myXhr.upload.addEventListener('progress', function (e) {
							          if (e.lengthComputable) {
							            $('progress').attr({
							              value: e.loaded,
							              max: e.total,
							            });
							          }
							        }, false);
							      }
							      return myXhr;
							    },
	      			   	  */    
	      			   	     
	      			   	     success: function (messaggio, textStatus, jqXHR) { //messaggio √® il messaggio ricevuto dalla servlet costituito da 4 campi: result che indica se l'associazione √® andata a buon fine o ha sollevato errori; messaggio che contiene il messaggio da stampare; redirect che √® una variabile booleana che indica se fare o meno il redirect; redirect_url che indica la pagina a cui effettuare il redirect
	      			        	console.log("SUCCESSS insert file");
	      			        	console.log("DATA IN FINAL: " + messaggio);
		      			        
	      			        	let m = $.parseJSON(messaggio);
	      			      		console.log("messaggio: " + m);
	      			      	    console.log("messaggio.result: " + m.result);
      			        	    console.log("messaggio.messaggio: " + m.messaggio);
	      			      		
	      			      		
	      			      		if(m.result == true){ 
		      			       		console.log("result: " + m.result);
			      			       // Caricamento completato
			      			        progressBar.val(100);
			      			       
				      			  	let timerInterval
				      			    Swal.fire({
				      			    	icon: 'success',
				      			    //  title: m,
				      			    	text: m.messaggio,
				      			    //  html: 'I will close in <b>4000</b> milliseconds.',
				      			      	timer: 4000,
				      				    showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })     			   	
	      			       		}
	      			       		else{ //caricamento exploit non andato abuon fine      			       			
		      			       		console.log("result: " + m.result);
		      			       		console.log("messaggio in else: " + m.messaggio);
	      			       			let timerInterval
				      			    Swal.fire({
				      			    	icon: 'error',
				      			   // 	title: m,
				      			    	text: m.messaggio,
				      			   //     html: 'I will close in <b>3</b> milliseconds.',
				      			      	timer: 4000,
				      				  //showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })       			       		
	      			       		}
	      			             				      			      	
					      		  					
	      			         },
	      			         error: function (jqXHR, textStatus, errorThrown) {
	      			        	 console.log("ERROREEEE");
	      			        	 alert('State Unavailable');
	      			        	 //window.location.href = "dashboard.html"
	      			         },
	      			         cache: false
	      			     });
	      				
                   }
      			});
        		
                    
        		//*** FUNZIONE PER CARICARE LA SIGNATURE ***

        		
                $('#buttonUploadSignature').click(function () {	 
      			    console.log("CLIC BUTTOM");
      			   
      			    //e.preventDefault(); // Impedisce l'invio del form
      			    
      			    //prelevo tutti i dati inseriti nel form
      			    var form = $("#uploadformSignature")[0];
                    var dati = new FormData(form);
                    
      				let nameSignature = $('#nameSignature').val();
      				console.log("Name Signature Upload: " + nameSignature);
      				let signatureFile = $('#signatureFile').val();
      				console.log("Signature File: " + signatureFile);
      			    
      				if(nameSignature == ""){
      					//NESSUN NOME INSERITO
      		    		console.log("devi inserire un nome valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Inserire un nome valido per la Signature!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })			
      					
      				}
      				else if(signatureFile == ""){
      					console.log("inserire file")
      					console.log("devi inserire un file valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Nessun file inserito per l\'upload!',
      					    timer: 4000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })
      						
      				}
      				else{	      				
						showProgressBar2(); // Mostra la barra di avanzamento
	      				
      					var progressBar = $('#progressBar');
	      			   	     
	      				$.ajax({      					 
	      					 url: "ServletUploadSignature",
	      			         method: "POST",
	          				 encType: 'multipart/form-data',
	      			   	     cache: false,
	    					 contentType: false,
	    					 processData: false,
	      			   	     data: dati,    //$("#idForm").serialize()                    
	      			         xhr: function() {
							     var xhr = new window.XMLHttpRequest();
							
							     // Aggiungi un listener per l'evento di progresso
							     xhr.upload.addEventListener('progress', function(e) {
							       if (e.lengthComputable) {
							         var percent = Math.round((e.loaded / e.total) * 100);
							         progressBar.val(percent);
							       }
							     }, false);
		      			   	     
							     return xhr;
	      			       	 },
	      			    	  
	      			   	     success: function (messaggio, textStatus, jqXHR) { //messaggio √® il messaggio ricevuto dalla servlet costituito da 4 campi: result che indica se l'associazione √® andata a buon fine o ha sollevato errori; messaggio che contiene il messaggio da stampare; redirect che √® una variabile booleana che indica se fare o meno il redirect; redirect_url che indica la pagina a cui effettuare il redirect
	      			        	console.log("SUCCESSS insert file");
	      			        	console.log("DATA IN FINAL: " + messaggio);
		      			        
	      			        	let m = $.parseJSON(messaggio);
	      			      		console.log("messaggio: " + m);
	      			      	    console.log("messaggio.result: " + m.result);
      			        	    console.log("messaggio.messaggio: " + m.messaggio);
	      			      		
	      			      		
	      			      		if(m.result == true){ //associazione Nodo Sensore Sensore √® andata a buon fine
		      			       		console.log("result: " + m.result);
				      			  	
		      			            // Caricamento completato
			      			        progressBar.val(100);
	      			      		
	      			      		    let timerInterval
				      			    Swal.fire({
				      			    	icon: 'success',
				      			    //  title: m,
				      			    	text: m.messaggio,
				      			    //  html: 'I will close in <b>4000</b> milliseconds.',
				      			      	timer: 4000,
				      				    showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })     			   	
	      			       		}
	      			       		else{ //associazione Nodo Sensore Sensore NON √® andata a buon fine      			       			
		      			       		console.log("result: " + m.result);
		      			       		console.log("messaggio in else: " + m.messaggio);
	      			       			let timerInterval
				      			    Swal.fire({
				      			    	icon: 'error',
				      			   // 	title: m,
				      			    	text: m.messaggio,
				      			   //     html: 'I will close in <b>3</b> milliseconds.',
				      			      	timer: 4000,
				      				  //showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })       			       		
	      			       		}
	      			             				      			      	
					      		  					
	      			         },
	      			         error: function (jqXHR, textStatus, errorThrown) {
	      			        	 console.log("ERROREEEE");
	      			        	 alert('State Unavailable');
	      			        	 window.location.href = "dashboard.html"
	      			         },
	      			         cache: false
	      			     });
	      				
                   }
      			});
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
                
            });
                
          
    
        </script>
    </body>
</html>


