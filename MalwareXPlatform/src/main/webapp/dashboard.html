<!--  <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> DECOMMENTARE SE SI VUOLE UTILIZZARE LE EL JSP --> 

<!-- <%@page language="java" contentType="text/html" import="java.sql.*" pageEncoding="UTF-8"%> -->

<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
      <!--  <meta http-equiv=refresh content="5; url=/dashboard.html" />  Reindirizzare ad una pagina dopo 5 secondi -->  
        
        <title>DASHBOARD MalwareXPlatform</title>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <link rel="stylesheet" href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/wtf-forms.css">
  	    
      <!--  <link href="css/style.css" type="text/css" rel="stylesheet"> -->
      
        <style type="text/css">
        
        	.header {
			  overflow: hidden;
			  background-color: #f1f1f1;
			  padding: 10px 10px;
			}
			
			/* Style the header links */
			.header a {
			  float: left;
			  color: black;
			  text-align: center;
			  padding: 12px;
			  text-decoration: none;
			  font-size: 18px;
			  line-height: 25px;
			  border-radius: 4px;
			}
			
			/* Style the logo link (notice that we set the same value of line-height and font-size to prevent the header to increase when the font gets bigger */
			.header a.logo {
			  font-size: 25px;
			  font-weight: bold;
			  background: url('logo200X70.png');
			  width: 200px; 
			  height: 70px;
			}
			
			/* Change the background color on mouse-over */
			.header a:hover {
			  background-color: #ddd;
			  color: black;
			}
			
			/* Style the active/current link*/
			.header a.active {
			  background-color: dodgerblue;
			  color: white;
			}
			
			/* Float the link section to the right */
			.header-right {
			  float: right;
			  padding: 10px 10px;
			}
			
			/* Add media queries for responsiveness - when the screen is 500px wide or less, stack the links on top of each other */
			@media screen and (max-width: 500px) {
			  .header a {
			    float: none;
			    display: block;
			    text-align: left;
			  }
			  .header-right {
			    float: none;
			  }
			}
        
        
        /* 
        	.header{
			 	background-color:#DDDDDD;  
				background: -moz-linear-gradient(#DDDDDD, #ffffff ); 
				background: -webkit-linear-gradient(#DDDDDD, #ffffff); 
				width:auto; 
				height:80px; 
				padding: 0px 0px 0px 0px;
			} */
        
            body{
                background: url(sfondo_dashboard.jpg);
                background-size: cover;
                width: 100%;
  				height:100%;
            }
            
            .drop-down-list{
                margin: 40px auto 10px;
                width: 90%;
                padding: 30px;
            } 
            
            /* Create four equal columns that floats next to each other */
			.column {
			 float: left;
			 width: 50%;
			}
			
			div.clearer{
    		 float: none; clear: left
    		}	 
			
			/* Clear floats */
			.row:after {
			 content: "";
			 display: table;
			 clear: both;
			}
           
            /* Responsive layout - makes a two column-layout instead of four columns */
			@media screen and (max-width: 900px) {
			 .column {
			 width: 50%;
			 }
			}
			
			
			/* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
			@media screen and (max-width: 600px) {
			 .column {
			 width: 100%;
			 }
			}
			
		/* 	*,
			*:before,
			*:after {
			  -webkit-box-sizing: border-box;
			  -moz-box-sizing: border-box;
			  box-sizing: border-box;
			}
			
			body {
			  margin: 0;
			  padding: 2rem 1.5rem;
			  font: 1rem/1.5 "PT Sans", Arial, sans-serif;
			  color: #5a5a5a;
			} */
            
        </style>
        
    </head>
    
    <body class="">
        
            
            <div class="header">
			  <a href="dashboard.html" class="logo"></a>
			  <div class="header-right">
			    <a class="active" href="dashboard.html">Home</a>
			    <a href="admin.html">Admin Login</a>
			    <a href="#about">About</a>
			  </div>
			</div> 
			
           <div class="container">
           	  
   
   			  <!-- FORM PER LA CREAZIONE DEL PE file -->
                
	            <div class="drop-down-list card" style="float:center; ">  
	            	
	            	<!-- DEVO FARE LA DIVISIONE IN COLONNE -->
	            	
	            	<div class="column">
	            	
		            	<div class="center" style="float:center;" >
		                    <h5>SELECT EXPLOIT</h5>
		                </div>
		                <div class="divider"></div>
		                <!-- INSERIRE I NOMI DEGLI EXPLOIT -->
		             
	                
	                </div>
	                
	                
	                <div class="column">
	            	
		            	<div class="center" style="float:center;" >
		                    <h5>SELECT SIGNATURE</h5>
		                </div>
		                <div class="divider"></div>
		                
		                <!-- INSERIRE LE SIGNATURE -->
		              	                
	                </div>
	                
	            	<div class="clearer"> </div>
	            	
	         	     
	         	    <form> 
	            		
	            		<div class="column">
	            			
	            			<!-- <div class="input-field" style="padding: 10px 10px 10px 10px;">
	            				<input id="nameSensorNode" type="text" size="50" maxlength="300" title="Insert Sensor Node name" placeholder="Insert Sensor Node name" value="" name="device" >
	            			</div> -->
	            		
	            		
							<div class="input-field" style="padding: 10px 20px 10px 10px;">
		                        
		                        <select id="exploit" name="idExploit">
		                            <option>Select Exploit</option>
		                        </select>
		                        		                        	                        
		                    </div>  
		                    
	                    </div>  
	                    
	                    <div class="column">
	                    
	                    	<!-- <div class="input-field" style="padding: 10px 10px 10px 10px;">
	            				<input id="nameSensorNode" type="text" size="50" maxlength="300" title="Insert Sensor Node name" placeholder="Insert Sensor Node name" value="" name="device" >
	            			</div> -->
	                    
	                    	<div class="input-field" style="padding: 10px 10px 10px 20px;">
		                        
		                        <select id="signature" name="idSignature">
		                            <option>Select Signature</option>
		                        </select>
		                                             
		                        	                        
		                    </div> 
	                    
	                    </div>  
	                    
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Inject in .EXE " id="buttonCreate">          		
	                    <!-- <button class="btn" id="buttonCreate" >Create</button> CON <BUTTON> NON FUNZIONA IL redirect NELLE FUNZIONI JQUERY window.location.href = "dashboard.html" --> 
	                    </div>
	                    
	            	</form>
	          			 
	          			 	            
	            </div>
	                
	    	<!-- <div class="divider"></div> -->
	    
<!--  INSERIRE 2 MENU' PER L'UPLOAD DI EXPLOID E SIGNATURE, LE SIGNATURE POSSONO ESSERE CARICATE IN FORMATO .TXT -->
			  
			  
			<!-- PRIMA COLONNA PER L'UPLOAD DELL'EXPLOIT-->     
		 	<div class="column">
                        
            <!-- FORM PER L'UPLOAD DELL'EXPLOIT-->
                
	            <div class="drop-down-list card" style="float:left; ">  
	            	<div class="center">
	                    <h5>UPLOAD EXPLOIT</h5>
	                </div>
	            	<div class="divider"></div>
	            	
	            	
	            	<form id="uploadformExploit" method="POST" action="#" enctype="multipart/form-data"> 
	            	
	            		<div class="input-field">
	            			<input id="nameExploit" type="text" size="50" maxlength="300" title="Insert Exploit Name" placeholder="Insert Exploit Name" value="" name="exploitname" >
	            		</div>
	            	                		
						<div class="input-field">
	                        
	                        <input id="exploitFile" type="file" name="fileExploit">
	                        	                        	                        
	                    </div>
	                    <!-- <progress></progress>  -->   
	                    

						<!-- <label class="file">
						  <input type="file" id="file" aria-label="File browser example">
						  <span class="file-custom"></span>
						</label> -->

	                    
	                    
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Upload" id="buttonUploadExploit">          
	                    </div>
	            	</form>
	          			 
	          			 	            
	            </div>
	           
	       
         </div>
		 	
		 
		 <!-- SECONDA COLONNA PER L'UPLOAD DELLA SIGNATURE -->
		 	
		 <div class="column">
		 
		 	 <!-- FORM PER L'UPLOAD DELLA SIGNATURE-->
                
	            <div class="drop-down-list card" style="float:right; ">  
	            	<div class="center">
	                    <h5>UPLOAD SIGNATURE</h5>
	                </div>
	            	<div class="divider"></div>
	            	
	            	
	            	<form enctype="multipart/form-data"> 
	            		<div class="input-field">
	            			<input id="nameSignature" type="text" size="50" maxlength="300" title="Insert Signature Name" placeholder="Insert Signature Name" value="" name="signaturename" >
	            		</div>      		      		           		
	            		
	            		
						<div class="input-field">
	                        
	                        <input id="signatureFile" type="file" name="fileSignature">
	                        	                        	                        
	                    </div>  
	                    
	                               	
	            		<div class="center">
							<input class="btn" type="button" value="Upload" id="buttonUploadSignature">          
	                    </div>
	            	</form>
	          			 
	          			 	            
	            </div>
	           
		
	     </div>
		
		
		<div class="divider"></div>     
	     
	     
	    </div> 
 
               
      
	  	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> <!-- Utilizzata per i drop down menù -->
  	    
  	   
  	    <!-- Utilizzata per la finestra popout (Sweet Alert) con gli avvisi in seguito all'associazione o alla creazione dei nodi sensori -->
  	    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> 
  	    <script src="sweetalert2.all.min.js"></script>
  	    
  	   
        <script type="text/javascript">           
               
        
        	$(document).ready(function () {        		
                
        		//MENU' SELEZIONE EXPLOIT
        		$.ajax({
                	url: "ServletAjaxExploitList",
                    method: "GET",
                    data: {operation: 'exploitList'},
                    success: function (data, textStatus, jqXHR) {
  
                    	console.log("Exploit List: " + data);
                        let exploitList = $.parseJSON(data);
                        console.log("exploitList: " + exploitList);
                     
                        $.each(exploitList, function (key, value) {	
                    	  	console.log("value id: " + value.idExploit );
                        	console.log("value name: " + value.exploit);
                            $('#exploit').append('<option value="' + value.idExploit + '">' + value.exploit + '</option>')
                        });
                        $('select').formSelect();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#exploit').append('<option>Exploit Unavailable</option>');
                    },
                    cache: false
                });
        		
        		
        		//MENU' SELEZIONE SIGNATURE
        		$.ajax({
                	url: "ServletAjaxSignatureList",
                    method: "GET",
                    data: {operation: 'signatureList'},
                    success: function (data, textStatus, jqXHR) {
  
                    	console.log("Signature List: " + data);
                        let signatureList = $.parseJSON(data);
                        console.log("signatureList: " + signatureList);
                     
                        $.each(signatureList, function (key, value) {	
                    	  	console.log("value id: " + value.idSignature );
                        	console.log("value name: " + value.signature);
                            $('#signature').append('<option value="' + value.idSignature + '">' + value.signature + '</option>')
                        });
                        $('select').formSelect();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#signature').append('<option>Signature Unavailable</option>');
                    },
                    cache: false
                });
        		     		
        		
        	 	//FUNZIONE PER AVVIARE IL DOWNLOAD DEL FILE EXE CREATO
        		async function download(url, filename) {
        		    
        	 		console.log("ENTRO IN DOWNLOAD");
        	 		console.log(url);
        	 		
        	    	const data = await fetch(url)
        	    	console.log("data: " + data)
        	    	
        			const blob = await data.blob()
        			const objectUrl = URL.createObjectURL(blob)

        			const link = document.createElement('a')

        			link.setAttribute('href', objectUrl)
        			link.setAttribute('download', filename)
        			link.style.display = 'none'

        			document.body.appendChild(link)
        			  
        			link.click()
        			  
        			document.body.removeChild(link)
      
        		}; 
        		
        		//FUNZIONE CLIC BOTTOM CREATE FILE EXE
                $('#buttonCreate').click(function () {	 
      			    console.log("CLIC BUTTOM");
      			    
      			    //PRENDE L'EXPLOIT SCELTO
      				let idExploit = $('#exploit').val(); //sarebbe l'id nel form
      				console.log("EXPLOIT: " + exploit);
      				
      				//PRENDE LA SIGNATURE SCELTA      				
      				let idSignature = $('#signature').val(); //sarebbe l'id nel form
      				console.log("SIGNATURE ID: " + signature);
      			          				
      				//PREPARO IL PACCHETTO DA INVIARE ALLA SERVLET
      			    let dati = {
      			    	exploit : idExploit, //EXPLOIT
      			    	signature : idSignature //SIGNATURE
      			    };
      			  //console.log("DEVICE: " + dati.device);
      				
      			    //CHIAMA LA SERVLET DI CREAZIONE DELL'EXE
      			    $.ajax({      					 
      					 url: "ServletCreateExe",
      					 dataType: "json",
      					 method: "POST",
      			         data: dati,    //$("#idForm").serialize()                    
      			         async: false,
      			         
      			         //LA SERVLET DEVE INVIARE L'URL DEL FILE DA SCARICARE
      			         success: function (messaggio, textStatus, jqXHR) { //messaggio è il messaggio ricevuto dalla servlet
      			        	console.log("SUCCESSS");
      			        	
      			               			        	
      			            let url = messaggio.url;      			   
    			      		console.log("url: " + messaggio.url);
      			         
      			        	//INSERIRE IL MESSAGGIO CON ANIMAZIONE
      			          	let m = messaggio.messaggio;      			   
    			      		console.log("messaggio: " + messaggio.messaggio);
	      			       	
    			      		if(messaggio.result == true){ //associazione Nodo Sensore Sensore è andata a buon fine
	      			       		console.log("result true: " + messaggio.result);
			      			  	
	      			       	//AGGIUNGERE LA FUNZIONE PER SCARICARE IL FILE CREATO
	            			         
	         			        console.log("chiamo la funzione download")
	         			        console.log("url: " + messaggio.url)
		      			        //USARE L'URL PASSATO DALLA SERVLET
		      			        // Start file download.
		      			        download(messaggio.url, 'nomefile.exe')
			      			    // download(filename, text);
    			      		  			      		
    			      		
    			      		    let timerInterval
			      			    Swal.fire({
			      			    	icon: 'success',
			      			    //  title: m,
			      			    	text: m,
			      			    //  html: 'I will close in <b>3000</b> milliseconds.',
			      			      	timer: 2000,
			      				    showConfirmButton: true, //non mostrare il tasto ok
				      			  //confirmButtonText: 'Ho capito!'
			      			      	timerProgressBar: true,
			      			   /* 	didOpen: () => {
			      			        	Swal.showLoading()
			      			        	const b = Swal.getHtmlContainer().querySelector('b')
			      			        	timerInterval = setInterval(() => {
			      			          		b.textContent = Swal.getTimerLeft()
			      			        	}, 100)
			      			      	}, 
			      			      	willClose: () => {
			      			        	clearInterval(timerInterval)
			      			      	} */
			      	 		    }).then((result) => {
			       			    	if (result.dismiss === Swal.DismissReason.timer) {
			      			        	console.log('I was closed by the timer')
			      			      		window.location.href = "dashboard.html";
			      			      	}
			      			      	else{
			      			    		window.location.href = "dashboard.html";
			      			      	}
			      			    }) 
    			     		}
    			       		else{       			       			
	      			       		console.log("result false: " + messaggio.result);
	      			       		console.log("messaggio in else: " + messaggio.messaggio);
    			       			
	      			       		
	      			       		let timerInterval
			      			    Swal.fire({
			      			    	icon: 'error',
			      			   // 	title: m,
			      			    	text: m,
			      			   //     html: 'I will close in <b>3</b> milliseconds.',
			      			      	timer: 2000,
			      				  //showConfirmButton: true, //non mostrare il tasto ok
				      			  //confirmButtonText: 'Ho capito!'
			      			      	timerProgressBar: true,
			      			   /* 	didOpen: () => {
			      			        	Swal.showLoading()
			      			        	const b = Swal.getHtmlContainer().querySelector('b')
			      			        	timerInterval = setInterval(() => {
			      			          		b.textContent = Swal.getTimerLeft()
			      			        	}, 100)
			      			      	}, 
			      			      	willClose: () => {
			      			        	clearInterval(timerInterval)
			      			      	} */
			      		 	    }).then((result) => {
			       			    	if (result.dismiss === Swal.DismissReason.timer) {
			      			        	console.log('I was closed by the timer')
			      			      		window.location.href = "dashboard.html";
			      			      	}
			      			      	else{
			      			    		window.location.href = "dashboard.html";
			      			      	}
			      			    })       			       		
    			       		}
      			         },
      			         error: function (jqXHR, textStatus, errorThrown) {
      			        	 console.log("ERROREEEE");
      			        	 alert('<form>State Unavailable</form>');
      			         },
      			         cache: false
      			     });
      				
      			   
      			}); 
        		
        		/*FUNZIONE PER EFFETTUARE VERIFICHE SUL FILE DA CARICARE*/
                $('#exploitFile').on('change', function () {
                	  //Questa variabile contiene il file vero e proprio
                	  var file = this.files[0];
                	                 	  
                	  var filename = $('#exploitFile').val();
        			  console.log("filename: " + filename);
        				
                	  //Controlli sul file come dicevo prima
                	  //Ad esempio qui, controlliamo che il file non sia più grande di 1k
                	  if (file.size > 52428800) {
                		  let timerInterval
		      			    Swal.fire({
		      			    	icon: 'error',
		      			    	text: 'Il dimensione massima consentita per il file è 50MB',
		      			      	timer: 2000,
		      				    showConfirmButton: true, //non mostrare il tasto ok
		      			      	timerProgressBar: true,
		      			   /* 	didOpen: () => {
		      			        	Swal.showLoading()
		      			        	const b = Swal.getHtmlContainer().querySelector('b')
		      			        	timerInterval = setInterval(() => {
		      			          		b.textContent = Swal.getTimerLeft()
		      			        	}, 100)
		      			      	}, 
		      			      	willClose: () => {
		      			        	clearInterval(timerInterval)
		      			      	} */
		      			    }).then((result) => {
		       			    	if (result.dismiss === Swal.DismissReason.timer) {
		      			        	console.log('I was closed by the timer')
		      			      		window.location.href = "dashboard.html";
		      			      	}
		      			      	else{
		      			    		window.location.href = "dashboard.html";
		      			      	}
		      			    })
                	  }
                	  
                	 
                	  //Verifico l'estensione del file
                	  //Use a regular expression to trim everything before final dot
                      var extension = filename.replace(/^.*\./, '');
                	  console.log("extension: " + extension)
                	  // Iff there is no dot anywhere in filename, we would have extension == filename,
			          // so we account for this possibility now
			          if (extension == filename) {
			             extension = '';
			          } else {
			            // if there is an extension, we convert to lower case
			            // (N.B. this conversion will not effect the value of the extension
			            // on the file upload.)
			             extension = extension.toLowerCase();
			          }
					  
                	  //indicare le estensioni ammesse per il file
                	  var fileExtension = ['exe', 'py'];
                	  if ($.inArray(extension, fileExtension) == -1) {
                		  let timerInterval
		      			    Swal.fire({
		      			    	icon: 'error',
		      			    	text: 'Estensione file non valida! Sono ammessi solo file di tipo ' + fileExtension.join(', '),
		      			      	timer: 2000,
		      				    showConfirmButton: true, //non mostrare il tasto ok
		      			      	timerProgressBar: true,
		       			    }).then((result) => {
		       			    	if (result.dismiss === Swal.DismissReason.timer) {
		      			        	console.log('I was closed by the timer')
		      			      		window.location.href = "dashboard.html";
		      			      	}
		      			      	else{
		      			    		window.location.href = "dashboard.html";
		      			      	}
		      			    })
                       }			                	  
                	  
                	  
                	});	
        		
        		
        		
        		/* FUNZIONE PER CARICARE L'EXPLOIT */	
        		
                $('#buttonUploadExploit').click(function () {	 
      			    console.log("CLIC BUTTOM");
      			   
      			    //prelevo tutti i dati inseriti nel form
      			    var form = $("#uploadformExploit")[0];
                    var dati = new FormData(form);
                    
      				let nameExploit = $('#nameExploit').val();
      				console.log("Name Exploit Upload: " + nameExploit);
      				let exploitFile = $('#exploitFile').val();
      				console.log("Exploit File: " + exploitFile);
      			    
      				if(nameExploit == ""){
      					//NESSUN NOME INSERITO
      		    		console.log("devi inserire un nome valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Inserire un nome valido per l\'Exploit!',
      					    timer: 2000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })			
      					
      				}
      				else if(exploitFile == ""){
      					console.log("inserire file")
      					console.log("devi inserire un file valido");
      		    		let timerInterval
      					Swal.fire({
      						icon: 'error',
      					//  title: m,
      					    text: 'Nessun file inserito per l\'upload!',
      					    timer: 2000,
      						showConfirmButton: true, //non mostrare il tasto ok
      					    timerProgressBar: true,
      					    }).then((result) => {
      					    	if (result.dismiss === Swal.DismissReason.timer) {
      					        	console.log('I was closed by the timer')
      					        	window.location.href = "dashboard.html";
      					      	}
      					    	else{
      					    		window.location.href = "dashboard.html";
      					    	}
      					    })
      						
      				}
      				else{	      				
	      				
	      				 $.ajax({      					 
	      					 url: "ServletUploadExploit",
	      			         method: "POST",
	          				 encType: 'multipart/form-data',
	      			   	     cache: false,
	    					 contentType: false,
	    					 processData: false,
	      			   	     data: dati,    //$("#idForm").serialize()                    
	      			         
	      			   	     // Esecuzione della XMLHTTP REquest
						/*	    xhr: function () {
							      var myXhr = $.ajaxSettings.xhr();
							      if (myXhr.upload) {
							        
							        //Qui, agiamo a tutti gli effetti sul tag "PROGRESS" in modo tale da aggiornare l'utente finale sul progresso di upload
							        myXhr.upload.addEventListener('progress', function (e) {
							          if (e.lengthComputable) {
							            $('progress').attr({
							              value: e.loaded,
							              max: e.total,
							            });
							          }
							        }, false);
							      }
							      return myXhr;
							    },
	      			   	  */    
	      			   	     
	      			   	     success: function (messaggio, textStatus, jqXHR) { //messaggio è il messaggio ricevuto dalla servlet costituito da 4 campi: result che indica se l'associazione è andata a buon fine o ha sollevato errori; messaggio che contiene il messaggio da stampare; redirect che è una variabile booleana che indica se fare o meno il redirect; redirect_url che indica la pagina a cui effettuare il redirect
	      			        	console.log("SUCCESSS insert file");
	      			        	console.log("DATA IN FINAL: " + messaggio);
		      			        
	      			        	let m = $.parseJSON(messaggio);
	      			      		console.log("messaggio: " + m);
	      			      	    console.log("messaggio.result: " + m.result);
      			        	    console.log("messaggio.messaggio: " + m.messaggio);
	      			      		
	      			      		
	      			      		if(m.result == true){ //associazione Nodo Sensore Sensore è andata a buon fine
		      			       		console.log("result: " + m.result);
				      			  	let timerInterval
				      			    Swal.fire({
				      			    	icon: 'success',
				      			    //  title: m,
				      			    	text: m.messaggio,
				      			    //  html: 'I will close in <b>3000</b> milliseconds.',
				      			      	timer: 2000,
				      				    showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })     			   	
	      			       		}
	      			       		else{ //associazione Nodo Sensore Sensore NON è andata a buon fine      			       			
		      			       		console.log("result: " + m.result);
		      			       		console.log("messaggio in else: " + m.messaggio);
	      			       			let timerInterval
				      			    Swal.fire({
				      			    	icon: 'error',
				      			   // 	title: m,
				      			    	text: m.messaggio,
				      			   //     html: 'I will close in <b>3</b> milliseconds.',
				      			      	timer: 2000,
				      				  //showConfirmButton: true, //non mostrare il tasto ok
					      			  //confirmButtonText: 'Ho capito!'
				      			      	timerProgressBar: true,
				      			   /* 	didOpen: () => {
				      			        	Swal.showLoading()
				      			        	const b = Swal.getHtmlContainer().querySelector('b')
				      			        	timerInterval = setInterval(() => {
				      			          		b.textContent = Swal.getTimerLeft()
				      			        	}, 100)
				      			      	}, 
				      			      	willClose: () => {
				      			        	clearInterval(timerInterval)
				      			      	} */
				      			    }).then((result) => {
				       			    	if (result.dismiss === Swal.DismissReason.timer) {
				      			        	console.log('I was closed by the timer')
				      			      		window.location.href = "dashboard.html";
				      			      	}
				      			      	else{
				      			    		window.location.href = "dashboard.html";
				      			      	}
				      			    })       			       		
	      			       		}
	      			             				      			      	
					      		  					
	      			         },
	      			         error: function (jqXHR, textStatus, errorThrown) {
	      			        	 console.log("ERROREEEE");
	      			        	 alert('State Unavailable');
	      			        	 //window.location.href = "dashboard.html"
	      			         },
	      			         cache: false
	      			     });
	      				
                   }
      			});
        		
                        		
                
            });
                
          
    
        </script>
    </body>
</html>


